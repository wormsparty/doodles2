(window["webpackJsonpreact-app"]=window["webpackJsonpreact-app"]||[]).push([[0],[,,,,,,,,,,function(e,t,n){e.exports=n(19)},,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var i=n(3),s=n.n(i),r=n(8),a=n.n(r),o=(n(15),n(0)),h=n(1),l=n(5),u=n(4),$=n(6),c=(n(16),n(2)),p=n(9),d=function(){function e(t,n,i,s,r,a){Object(o.a)(this,e),this.ctx=void 0,this.referenceWidth=void 0,this.referenceHeight=void 0,this.fontSize=void 0,this.font=void 0,this.fontFamily=void 0,this.windowWidth=void 0,this.windowHeight=void 0,this.marginLeft=void 0,this.marginRight=void 0,this.marginTop=void 0,this.marginBottom=void 0,this.scaleFactor=void 0,this.tilesize=void 0,this.ctx=t.getContext("2d"),this.scaleFactor=1,this.marginLeft=0,this.marginRight=0,this.marginTop=0,this.marginBottom=0,this.windowWidth=0,this.windowHeight=0,this.referenceWidth=n,this.referenceHeight=i,this.fontSize=s,this.fontFamily=r,this.font=s+"px "+r,this.tilesize=a}return Object(h.a)(e,[{key:"resize",value:function(e,t,n,i,s,r,a){this.scaleFactor=e,this.marginLeft=t,this.marginRight=n,this.marginTop=i,this.marginBottom=s,this.windowWidth=r,this.windowHeight=a,this.ctx.imageSmoothingEnabled=!1}},{key:"img",value:function(e,t,n,i){var s=this.tilesize*n,r=this.tilesize*i,a=0,o=0,h=0,l=0;if(t.x<0&&(a=-t.x),t.y<0&&(h=-t.y),t.x+this.tilesize>this.referenceWidth&&(o=t.x+this.tilesize-this.referenceWidth),t.y+this.tilesize>this.referenceHeight&&(l=t.y+this.tilesize-this.referenceHeight),a<this.tilesize&&o<this.tilesize&&h<this.tilesize&&l<this.tilesize){var u=(t.x+a)*this.scaleFactor+this.marginLeft,$=(t.y+h)*this.scaleFactor+this.marginTop;this.ctx.drawImage(e.image,s+a,r+h,this.tilesize-a-o,this.tilesize-h-l,u,$,(this.tilesize-a-o)*this.scaleFactor,(this.tilesize-h-l)*this.scaleFactor)}}},{key:"rect",value:function(e,t,n,i){this.ctx.fillStyle=i;var s=e.x,r=e.y;s<0&&(t+=s,s=0),r<0&&(n+=r,r=0),s>=this.referenceWidth&&(t-=s-this.referenceWidth,s=this.referenceWidth-1),r>=this.referenceHeight&&(n-=r-this.referenceHeight,r=this.referenceHeight-1),t<=0||n<=0||this.ctx.fillRect(this.marginLeft+s*this.scaleFactor,this.marginTop+r*this.scaleFactor,t*this.scaleFactor,n*this.scaleFactor)}},{key:"text",value:function(e,t,n){this.ctx.fillStyle=n,this.ctx.font=this.font;var i=t.x,s=t.y+this.fontSize-3;this.ctx.save(),this.ctx.translate(this.marginLeft,this.marginTop),this.ctx.scale(this.scaleFactor,this.scaleFactor),this.ctx.fillText(e,i,s),this.ctx.restore()}},{key:"clear",value:function(e){this.ctx.fillStyle="rgba(5, 5, 5, 1)";var t=this.marginLeft,n=this.marginRight,i=this.marginBottom,s=this.marginTop,r=this.windowWidth,a=this.windowHeight;this.ctx.fillRect(0,0,t,a),this.ctx.fillRect(t,0,r-n-t,s),this.ctx.fillRect(r-n,0,n,a),this.ctx.fillRect(t,a-i,r-n-t,i),this.ctx.fillStyle=e,this.ctx.fillRect(t,s,r-t-n,a-i-s)}},{key:"get_char_width",value:function(){return 8}}]),e}(),v="#000000",f="#FFFF00",g=new Map([["#","#646464"],[".","#646464"],["~","#C8C8C8"]]),w=["1","2","3","4","5","6","7","8","9","0",">","<"],y=["*","$","/","\\"],m=[".","<",">"],M=["x"],F=new Map([["t","#6699FF"],["@","#FF0000"]]),_=new Map([["$","#FFFF00"],["=","#FF0000"],["*","#dd99FF"],["%","#119900"],["/","#999999"],["\\","#FFFFFF"]]),x=["/","\\"],b=["*"],k=new Map([["*","#999999"],["&","#FF0000"]]),O=new Map([["/",1],["\\",3],["",0]]),D=function(){function e(t,n){Object(o.a)(this,e),this.x=void 0,this.y=void 0,this.x=t,this.y=n}return Object(h.a)(e,[{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"copy",value:function(){return new e(this.x,this.y)}}]),e}(),j=function(e){function t(e,n,i){var s;return Object(o.a)(this,t),(s=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).id=void 0,s.id=i,s}return Object($.a)(t,e),t}(D),P=function(e){function t(e,n,i){var s;return Object(o.a)(this,t),(s=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).usage=void 0,s.usage=i,s}return Object($.a)(t,e),Object(h.a)(t,[{key:"copy",value:function(){return new t(this.x,this.y,this.usage)}}]),t}(D),S=function(e){function t(e,n,i,s,r,a){var h;return Object(o.a)(this,t),(h=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).vx=void 0,h.vy=void 0,h.symbol=void 0,h.power=void 0,h.vx=i,h.vy=s,h.symbol=r,h.power=a,h}return Object($.a)(t,e),Object(h.a)(t,[{key:"copy",value:function(){return new t(this.x,this.y,this.vx,this.vy,this.symbol,this.power)}}]),t}(D),z=function(){function e(t,n,i,s,r,a,h,l,u,$){Object(o.a)(this,e),this.map=void 0,this.meta=void 0,this.teleportMap=void 0,this.tile2color=void 0,this.texts=void 0,this.teleports=void 0,this.teleportCount=void 0,this.obstacles=void 0,this.obstacleColor=void 0,this.initialItemPositions=void 0,this.start=void 0,this.backgroundColor=void 0,this.textColor=void 0,this.targetSpawner=void 0,this.obstacleVisible=function(){return!1},this.map=t,this.meta=n,this.teleportMap=i,this.tile2color=s,this.texts=r,this.teleports=new Map,this.teleportCount=new Map,this.initialItemPositions=new Map,this.start=new D(0,0),this.targetSpawner=l,this.obstacles=new Map,null!=u&&(this.obstacleVisible=u),this.backgroundColor=void 0!==a?a:v,this.textColor=""!==h?h:f,this.obstacleColor=void 0!==$?$:f}return Object(h.a)(e,[{key:"parse",value:function(e){var t=this.map.split("\n"),n=this.meta.split("\n");22!==t.length&&console.log("La carte V "+e+" n'a pas exactement 22 lignes ("+t.length+")"),22!==n.length&&console.log("La carte M "+e+" n'a pas exactement 22 lignes ("+n.length+")");for(var i=0;i<22;i++)56!==t[i].length&&console.log("V "+e+" l."+i+" n'a pas exactement 56 chars ("+t[i].length+")"),56!==n[i].length&&console.log("M "+e+" l."+i+" n'a pas exactement 56 chars ("+n[i].length+")");for(var s=0;s<22;s++)for(var r=0;r<56;r++){var a=n[s][r];"#"===a?"#"!==t[s][r]&&console.log("Les murs ne marchent pas en ("+r+", "+s+"), carte = "+e):w.indexOf(a)>-1?(this.teleports.has(a)||(this.teleports.set(a,[]),this.teleportCount.set(a,0)),this.teleports.get(a).push(new j(r,s,this.teleportCount.get(a))),this.teleportCount.set(a,this.teleportCount.get(a)+1)):y.indexOf(a)>-1?(this.initialItemPositions.has(a)||this.initialItemPositions.set(a,[]),this.initialItemPositions.get(a).push(new P(r,s,1))):M.indexOf(a)>-1?(this.obstacles.has(a)||this.obstacles.set(a,[]),this.obstacles.get(a).push(new D(r,s))):" "!==a&&void 0!==a&&("@"===a?this.start=new D(r,s):console.log("Unknown char: "+a))}}},{key:"get_symbol_at",value:function(e,t){return this.map[57*t+e]}}]),e}(),T=function(){function e(t,n,i,s,r,a,h){Object(o.a)(this,e),this.canvas=void 0,this.graphics=void 0,this.referenceWidth=0,this.referenceHeight=0,this.integerZoom=!1,this.mousePosX=0,this.mousePosY=0,this.canvas=document.getElementById(t),this.graphics=new d(this.canvas,n,i,s,r,h),this.graphics?(this.referenceWidth=n,this.referenceHeight=i,this.integerZoom=a,null!=this.canvas&&this.canvas.focus()):console.log("Failed to load Canvas2D.")}return Object(h.a)(e,[{key:"setMousePos",value:function(e,t){this.mousePosX=Math.floor((e-this.graphics.marginLeft)/this.graphics.scaleFactor),this.mousePosY=Math.floor((t-this.graphics.marginTop)/this.graphics.scaleFactor)}},{key:"click",value:function(e,t){this.setMousePos(e,t)}},{key:"clear",value:function(e){this.graphics.clear(e)}},{key:"rect",value:function(e,t,n,i){this.graphics.rect(e,t,n,i)}},{key:"text",value:function(e,t,n){this.graphics.text(e,t,n)}},{key:"textCentered",value:function(e,t,n){var i=new D(this.referenceWidth/2-this.get_char_width()*e.length/2,t);this.text(e,i,n)}},{key:"get_char_width",value:function(){return this.graphics.get_char_width()}},{key:"img",value:function(e,t,n,i){this.graphics.img(e,t,n,i)}},{key:"getZoom",value:function(e,t,n,i){var s=t/i,r=e/n;return s<r&&(r=s),this.integerZoom?((r=Math.floor(r))<1&&(r=1),r):r}},{key:"resize",value:function(e,t){var n=this.getZoom(e,t,this.referenceWidth,this.referenceHeight),i=Math.floor((e-this.referenceWidth*n)/2),s=Math.floor((t-this.referenceHeight*n)/2),r=Math.floor(e-this.referenceWidth*n-2*i),a=Math.floor(t-this.referenceHeight*n-2*s);null!=this.canvas&&(this.canvas.width=e,this.canvas.height=t),this.graphics.resize(n,i+r,i,s+a,s,e,t)}}]),e}(),C=new Map([["en",new Map([["M"," taken"]])],["fr",new Map([["M"," pris"],["F"," prise"]])]]),L=new Map([["en","[5] Take "],["fr","[5] Prendre "]]),W=new Map([["en","Throw"],["fr","Lancer"]]),H=new Map([["en",new Map([["M"," thrown"]])],["fr",new Map([["M"," lanc\xe9"],["F"," lanc\xe9e"]])]]),E=new Map([["en",new Map([["*",{text:"rock",genre:"M"}],["/",{text:"sword",genre:"M"}],["\\",{text:"sword lvl.2",genre:"M"}],["=",{text:"fire spell",genre:"M"}],["",{text:"nothing",genre:"M"}]])],["fr",new Map([["*",{text:"caillou",genre:"M"}],["/",{text:"\xe9p\xe9e",genre:"F"}],["\\",{text:"\xe9p\xe9e lvl.2",genre:"F"}],["=",{text:"sort de feu",genre:"M"}],["",{text:"rien",genre:"M"}]])]]),I=new Map([["en",new Map([["#","Crushed!"],["~","Drown!"],["v","Impaled!"],[">","Impaled!"],["<","Impaled!"],["^","Impaled!"]])],["fr",new Map([["#","\xc9cras\xe9!"],["~","Noy\xe9!"],["v","Empal\xe9!"],["<","Empal\xe9!"],[">","Empal\xe9!"],["^","Empal\xe9!"]])]]),A=new Map([["en","Space to retry"],["fr","Espace pour r\xe9essayer"]]),R=new Map([["en","New game"],["fr","Nouvelle partie"]]),U=new Map([["en","Load"],["fr","Charger"]]),X=new Map([["en","Save"],["fr","Sauver"]]),Y=new Map([["en","Exit"],["fr","Quitter"]]),N=function(){function e(t,n,i,s){Object(o.a)(this,e),this.pos=void 0,this.symbol=void 0,this.pv=void 0,this.pvMax=void 0,this.pos=t,this.symbol=n,this.pv=i,this.pvMax=s}return Object(h.a)(e,[{key:"copy",value:function(){return new e(this.pos.copy(),this.symbol,this.pv,this.pvMax)}}]),e}(),q=function(){function e(t,n){Object(o.a)(this,e),this.targets=void 0,this.tick=void 0,this.targets=t,this.tick=n}return Object(h.a)(e,[{key:"print",value:function(){for(var e={targets:[],tick:this.tick},t=0;t<this.targets.length;t++)e.targets[t]={pos:{x:this.targets[t].pos.x,y:this.targets[t].pos.y},symbol:this.targets[t].symbol,pv:this.targets[t].pv,pv_max:this.targets[t].pvMax};return e}},{key:"copy",value:function(){var t=new e([],this.tick),n=!0,i=!1,s=void 0;try{for(var r,a=this.targets[Symbol.iterator]();!(n=(r=a.next()).done);n=!0){var o=r.value;t.targets.push(o.copy())}}catch(h){i=!0,s=h}finally{try{n||null==a.return||a.return()}finally{if(i)throw s}}return t}},{key:"reset",value:function(){this.tick=0,this.targets.splice(0,this.targets.length)}}],[{key:"parse",value:function(t){if(null===t)return null;var n=new e([],t.tick),i=!0,s=!1,r=void 0;try{for(var a,o=t.targets[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){var h=a.value;n.targets.push(new N(new D(h.pos.x,h.pos.y),h.symbol,h.pv,h.pvMax))}}catch(l){s=!0,r=l}finally{try{i||null==o.return||o.return()}finally{if(s)throw r}}return n}}]),e}(),B=function(){function e(t,n,i){Object(o.a)(this,e),this.spawnerUpdate=void 0,this.targetUpdate=void 0,this.pv2color=void 0,this.spawnerUpdate=t,this.targetUpdate=n,this.pv2color=i}return Object(h.a)(e,[{key:"inner_update",value:function(e,t,n,i,s,r){var a=e.hits_projectile(n.pos),o=Object(c.a)(a,2),h=o[0],l=o[1];if(-1!==h&&(e.projectile2item(e.currentMapData,n.pos,h),n.pv-=l,n.pv<=0))return i.targets.splice(t,1),[!1,null];if(n.pos.equals(s)){if("O"!==n.symbol)return e.gameOverMessage=I.get("fr").get(n.symbol),[!0,s];s.x+=r.x,s.y+=r.y}return[!0,null]}},{key:"update",value:function(e,t,n){this.spawnerUpdate(t);for(var i=0;i<t.targets.length;){var s=t.targets[i],r=this.targetUpdate(s.symbol),a=this.inner_update(e,i,s,t,n,r),o=Object(c.a)(a,2),h=o[0],l=o[1];if(h){if(null!==l)return l;if(s.pos.x+=r.x,s.pos.y+=r.y,s.pos.y>=22||s.pos.y<0||s.pos.x<0||s.pos.x>=56||"#"===e.get_symbol_at(s.pos))t.targets.splice(i,1);else{var u=this.inner_update(e,i,s,t,n,r),$=Object(c.a)(u,2);if(h=$[0],l=$[1],h){if(null!==l)return l;i++}}}}return n}}]),e}(),V=new z("                                           ~~~~~~~~~~~~~\n                                                ~~~~~~~~\n                                                 ~~~~~~~\n                                              ~~~~~~~~~~\n                                    ##        ~~~~~~~~~~\n                                 *********        ~~~~~~\n                               ***********          ~~~~\n                             *************           ~~~\n                             **************      ~~~~~~~\n                             **************     ~~~~~~~~\n                             **************  ~~~~~~~~~~~\n                              ************~~~~~~~~~~~~~~\n                         ~~~~~~~~********~~~~~~~~~~~~~~~\n                    ~~~~~~~~~~~~~~~~##~~~~~~~~~~~~~~~~~~\n               ~~~~~~~############################~~~###\n            ~~~~~~~~~~~#................................\n          ~~~~~~~~~~~~~~##.......................#~~~###\n           ~~~~~~~~~~~~~~~#######################~~~~~~~\n               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n                         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n                                 ~~~~~~~~~~~~~~~~~~~~~~~\n                                          ~~~~~~~~~~~~~~","                                                        \n                                                        \n                                                        \n                                                        \n                                    ##                  \n                                                        \n                                                        \n                                                        \n                                                        \n                                                        \n                                                        \n                                                        \n                                                        \n                                    ##                  \n                      ############################   ###\n                       #     @                         1\n                        ##                       #   ###\n                          #######################       \n                                                        \n                                                        \n                                                        \n                                                        ",new Map([["1","mission"]]),new Map([["~","#0000FF"],[".","#FF7700"],["#","#AA3300"],[">","#FFFFFF"]]),new Map([["en",new Map([["Thirsty for adventure,",new D(4,3)],["you sailed to new lands.",new D(4,4)],["After quiet and storm,",new D(4,6)],["filled with hope, you",new D(4,7)],["finally land.",new D(4,8)]])],["fr",new Map([["En soif de nouvelles aventures,",new D(4,3)],["vous avez pris le large.",new D(4,4)],["Apr\xe8s calme et temp\xeates,",new D(4,6)],["rempli d'espoirs, vous",new D(4,7)],["accostez sur une",new D(4,8)],["terre nouvelle.",new D(4,9)]])]]),"#000005","",null,null,""),K=new z("                                                        \n         ***************************************        \n        *                                       *       \n       *             ------------                *      \n       *            ------[]------         $     *      \n       *            --------------  $      $     *      \n       *         $  --------------  $      $     *      \n   ~~~~*  $   $  $  --------------  $  $   $     *~~~~~ \n  ~~~~~~*                                        *~~~~~~\n~~~~~~~~~***********************     ************~~~~~~~\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~**  *~~~~~~~~~~~~~~~~~~~\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~**~~~~~~~~~~~~~~~~~~~~\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~###*####################\n################################...m....................\n........................................................\n################################........................\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~########################\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ \n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~        \n           ~~~~~~~~~~~~~~~~~~                           \n               ~~~~~~~~~~~                              \n                                                        ","                                                        \n                                                        \n                                                        \n                                                        \n                                                        \n                                                        \n                                                        \n                                                        \n                                                        \n                                                        \n                                                        \n                                                        \n                                ### ####################\n################################                       2\n1                                                      2\n################################                       2\n                                ########################\n                                                        \n                                                        \n                                                        \n                                                        \n                                                        ",new Map([["1","bateau"],["2","outside"]]),new Map([["~","#0000FF"],[".","#FF7700"],["#","#AA3300"],["*","#FFFFFF"]]),new Map,"#000005","",null,null,""),Z=new z('      """"""              #...........#                 \n       """"               #............#     """""""    \n                          #.............#      """"""   \n                          #..............#####          \n                         #....................#####     \n                        #..........................#####\n     """"              #................................\n    """"""            #.................................\n     """"           ##..................................\n                 ###....................................\n            #####.....................................##\n       #####........................................##  \n#######...........................................##    \n................................................##      \n...........................................#####        \n....................................#######             \n#######...................##########                    \n       ##.............####                      ""      \n         ##........###                         """"     \n           ########                             ""      \n                     """                                \n                    """""                               ',"                          #11111111111#                 \n                          #            #                \n                          #             #               \n                          #              #####          \n                         #                    #####     \n                        #                          #####\n                       #                               3\n                      #                                3\n                    ##                                 3\n                 ###                                   3\n            #####                                     ##\n       #####                                        ##  \n#######                                           ##    \n2                                               ##      \n2                                          #####        \n2                                   #######             \n#######                   ##########                    \n       ##             ####                              \n         ##        ###                                  \n           ########                                     \n                                                        \n                                                        ",new Map([["1","spike"],["2","mission"],["3","training"]]),new Map([["$","#FF00AA"],["#","#555555"],[".","#333333"],['"',"#00FF00"],["^","#FFFF00"],[">","#FFFFFF"],["<","#FFFFFF"]]),new Map,"#050505","",null,null,""),J=new z("                       #~~~~~~~~~~~~~~~~#               \n                       #~~~~~~~~~~~~~~~~#               \n                      #~~~........~~~~~~~#              \n#####               ##~~..............~~~~##            \n.....####        ###........................###         \n.........########..............................###      \n..................................................######\n.....######.............................................\n#####      #####........................................\n                ##......................................\n                  #.....................................\n                   #.................................###\n                   #................................#   \n                  #...............................##    \n                 #~~~~.........................###      \n               ##~~~~~~...............~~~~~####         \n            ###~~~~~~~~~~......~~~~~~~~####             \n          ##~~~~~~~~~~~~~~~~~~~~~~~~~~#                 \n         #~~~~~~~~~~~~~~~~~~~~~~~~~~~#                  \n        #~~~~~~~~~~~~~~~~~~~~~~~~~~~~~##                \n       #~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~##              \n       #~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#             ","                       #                #               \n                       #                #               \n                      #                  #              \n#####               ##                    ##            \n3    ####        ###                        ###         \n3        ########                              ###      \n3 @                                               ######\n3    ######                                            1\n#####      #####                                       1\n                ##                                     1\n                  #                                    1\n                   #                                 ###\n                   #                                #   \n                  #                               ##    \n                 #                             ###      \n               ##          *               ####         \n            ###                        ####             \n          ##                          #                 \n         #                           #                  \n        #                             ##                \n       #                                ##              \n       #                                  #             ",new Map([["1","leaveRock"],["3","outside"]]),new Map([["~","#0000FF"]]),new Map,"#020302","",new B(function(e){e.tick=(e.tick+1)%20,e.tick>=16||(e.targets.push(new N(new D(40-e.tick,-1),"O",3,3)),e.targets.push(new N(new D(39-e.tick,-1),"O",3,3)))},function(){return new D(0,1)},function(e){return 3===e?"#00FF00":2===e?"#FF9900":"#FF0000"}),null,""),Q=new z("                      #.................#               \n                      #.................#               \n                      #.................#               \n                     #...................#              \n                      #..................#              \n     ~~~~~            #.................#               \n   ~~~~~~~~~~~~      #..................#               \n      ~~~~~~         #..................#               \n                     #..................#      ~~~~     \n                     #..................#     ~~~~~~~~  \n                     #..................#       ~~~~~   \n                     #...................#              \n                     #...................#              \n                      #..................#              \n                      #..................#              \n                      #..................#              \n                       #.................#              \n         ~~~~~~        #................#               \n      ~~~~~~~          #...............#                \n         ~~~~~~        #...............#                \n                        #.............#                 \n                         #...........#                  ","                      #22222222222222222#               \n                      #                 #               \n                      #                 #               \n                     #                   #              \n                      #                  #              \n                      #                 #               \n                     #                  #               \n                     #                  #               \n                     #                  #               \n                     #                  #               \n                     #                  #               \n                     #                   #              \n                     #                   #              \n                      #                  #              \n                      #                  #              \n                      #                  #              \n                       #                 #              \n                       #                #               \n                       #               #                \n                       #      @        #                \n                        #             #                 \n                         #11111111111#                  ",new Map([["1","outside"],["2","spike2"]]),new Map([["#","#555555"],["~","#0000FF"]]),new Map,"#050505","",new B(function(e){e.tick=(e.tick+1)%32;var t=e.tick;e.tick>=17&&(t=32-e.tick),e.targets.push(new N(new D(23+t,-1),"v",1,1))},function(){return new D(0,1)},function(e){return"#00FF00"}),null,""),G=new z("                      #.................#               \n                      #.................#               \n                      #.................#               \n                      #.................#               \n                      #.................#               \n     ~~~~~            #.................#               \n   ~~~~~~~~~~~~       #.................#               \n      ~~~~~~          #.................#               \n                      #.................#      ~~~~     \n                      #.................#     ~~~~~~~~  \n                      #.................#       ~~~~~   \n                      #.................#               \n                      #.................#               \n                      #.................#               \n                      #.................#               \n                      #.................#               \n                      #.................#               \n         ~~~~~~       #.................#               \n      ~~~~~~~          #.................#              \n         ~~~~~~        #.................#              \n                       #.................#              \n                       #.................#              ","                      #11111111111111111#               \n                      #                 #               \n                      #                 #               \n                      #                 #               \n                      #                 #               \n                      #                 #               \n                      #                 #               \n                      #                 #               \n                      #                 #               \n                      #                 #               \n                      #                 #               \n                      #                 #               \n                      #                 #               \n                      #                 #               \n                      #                 #               \n                      #                 #               \n                      #                 #               \n                      #                 #               \n                       #                 #              \n                       #       @         #              \n                       #                 #              \n                       #22222222222222222#              ",new Map([["1","swordTreasure"],["2","spike"]]),new Map([["#","#555555"],["~","#0000FF"]]),new Map,"#050505","",new B(function(e){e.tick=(e.tick+1)%32;var t=e.tick;e.tick>=17&&(t=32-e.tick),e.targets.push(new N(new D(23+t,-1),"v",1,1)),e.targets.push(new N(new D(22+t,-1),"v",1,1))},function(){return new D(0,1)},function(e){return"#00FF00"}),null,""),ee=new z("                                                        \n                                             ~~~~       \n    ~~~~                                       ~~~~     \n      ~~~~~~                                            \n              #############################             \n         #####.............................####         \n       ##......................................##       \n      #..........................................#      \n     #............................................#     \n     #............................................#     \n     #............................................#     \n     #............................................#     \n      #..........................................#      \n       ##......................................##       \n         #####............................#####         \n              ####....................####              \n                  #..................#       ~~         \n      ~~~~~~      #..................#        ~~~       \n   ~~~~~~~        #..................#                  \n      ~~~~~~      #..................#                  \n                  #..................#                  \n                   #.................#                  ","                                                        \n                                                        \n                                                        \n                                                        \n              #############################             \n         #####                             ####         \n       ##                                      ##       \n      #                                          #      \n     #                                            #     \n     #                                            #     \n     #          $                     /           #     \n     #                                            #     \n      #                                          #      \n       ##                                      ##       \n         #####                            #####         \n              ####                    ####              \n                  #                  #                  \n                  #                  #                  \n                  #                  #                  \n                  #                  #                  \n                  #                  #                  \n                   #11111111111111111#                  ",new Map([["1","spike2"]]),new Map([["#","#555555"],["~","#0000FF"]]),new Map,"#050500","",null,null,""),te=new z('                       #~~~~.~~~~~~~~~~~#               \n     """               #~~~...~~~~~~~~~~#       """     \n       """            #~........~~~~~~~~~#       """"   \n                    ##~..............~~~~~##            \n                 ###........................###         \n         ########..............................##       \n#########........................................#      \n..................................................#     \n..................................................#     \n..................................................#     \n..................................................#     \n#######...........................................#     \n       #####.....................................#      \n            ###.................................#       \n               ###.............................#        \n                  ####~~~~~~~......~~~~~~~~~###         \n    ""                ###~~~~~~~~~~~~~~~~###            \n   """"                  ################               \n    """"""                                         ""   \n      """""""                                   """"""  \n                                                 ""     \n                                                        ',"                       #2222222222222222#               \n                       #                #               \n                      #                  #              \n                    ##xxxxxxxxxxxxxxxxxxxx##            \n                 ###                        ###         \n         ########                              ##       \n#########                                        #      \n1                                                 #     \n1   @                                             #     \n1                                                 #     \n1                                                 #     \n#######                                           #     \n       #####                                     #      \n            ###                                 #       \n               ###                             #        \n                  ####                      ###         \n                      ###                ###            \n                         ################               \n                                                        \n                                                        \n                                                        \n                                                        ",new Map([["1","training"],["2","swordOnly"]]),new Map([["~","#0000FF"],['"',"#00FF00"]]),new Map,"#020302","",new B(function(e){e.targets.length>0?e.tick=9:(e.tick--,e.tick<=0&&(e.targets.push(new N(new D(31,13),"O",1,1)),e.tick=9))},function(){return new D(0,0)},function(e){return"#00FF00"}),function(e,t){return null!=e.currentMapData.spawner&&(0!==e.currentMapData.spawner.targets.length&&1090!==e.persistedData.coins)},"#FF8800"),ne=new z('                       #~~~~.~~~~~~~~~~#                \n          """          #~~.....~~~~~~~~~#    """        \n        """           #~~~........~~~~~~~#    """"      \n                    ##~~..............~~~~##            \n                 ###........................#           \n         ########............................#          \n#########.....................................#         \n...............................................#        \n...............................................#        \n...............................................#        \n...............................................#        \n#######........................................#        \n       #####...................................#        \n            ###...............................#         \n               ###...........................#          \n                  #~~~...........~~~~~~~~~~~#           \n        ""         ##~~~.......~~~~~~~~~~~~#            \n       """"          #~~~~.....~~~~~~~~~~~#   ""        \n       """"""         #~~~~...~~~~~~~~~~~#     """      \n                      #~~~~...~~~~~~~~~~~#    """       \n                      #~~~~...~~~~~~~~~~~#     ""       \n                       #~~~~.~~~~~~~~~~~#               ',"                       #111111111111111#                \n                       #                #               \n                      #                  #              \n                    ##                    ##            \n                 ###                        #           \n         ########                            #          \n#########                                     #         \n3                                              #        \n3                                              #        \n3                                              #        \n3                                              #        \n#######                                        #        \n       #####                                   #        \n            ###                               #         \n               ###                           #          \n                  #                         #           \n                   ##                      #            \n                     #                    #             \n                      #     @            #              \n                      #                  #              \n                      #                  #              \n                       #2222222222222222#               ",new Map([["1","hitSword"],["2","leaveRock"],["3","rotating"]]),new Map([["~","#0000FF"],['"',"#00FF00"]]),new Map,"#020302","",new B(function(e){e.targets.push(new N(new D(26+e.tick,-1),"v",1,1)),e.targets.push(new N(new D(-1,7+e.tick),">",1,1)),e.tick=(e.tick+1)%4},function(e){return"v"===e?new D(0,1):new D(1,0)},function(e){return"#00FFFF"}),null,""),ie=new z('                   #................#                   \n        """       #.................#             ""    \n      """"       #...................#           """"   \n                #.....................##           ""   \n               #........................##              \n              #...........................###           \n             #...............................###########\n            #...........................................\n            #...........................................\n            #...........................................\n            #...........................................\n            #....................................#######\n             #.................................##       \n              #...............................#         \n               ##............................#          \n                 ##.........................#           \n                   ##~....................~#            \n """"                #~~~...............~~~#            \n   """"               #~~~~..........~~~~~#             \n                       #~~~~~~~~~~~~~~~~~~#             \n                       #~~~~~~~~~~~~~~~~~#              \n                       #~~~~~~~~~~~~~~~~#               ',"                   #1111111111111111#                   \n                  #                 #                   \n                 #                   #                  \n                #                     ##                \n               #                        ##              \n              #                           ###           \n             #                               ###########\n            #                                          3\n            #                                     @    3\n            #                                          3\n            #                                          3\n            #                                    #######\n             #                                 ##       \n              #                               #         \n               ##                            #          \n                 ##                         #           \n                   ##                      #            \n                     #                     #            \n                      #                   #             \n                       #                  #             \n                       #                 #              \n                       #                #               ",new Map([["1","swordTreasure2"],["3","swordOnly"]]),new Map([["~","#0000FF"],['"',"#00FF00"]]),new Map,"#020302","",new B(function(e){2!==e.tick&&(e.targets.push(new N(new D(56,7+e.tick),"<",1,1)),e.targets.push(new N(new D(56,9+e.tick),"<",1,1))),e.tick=(e.tick+1)%3},function(e){return new D(-1,0)},function(e){return"#00FFFF"}),null,""),se=new z("                                                        \n                                             ~~~~       \n    ~~~~                                       ~~~~     \n      ~~~~~~                                            \n              #############################             \n         #####.............................####         \n       ##......................................##       \n      #..........................................#      \n     #............................................#     \n     #............................................#     \n     #............................................#     \n     #............................................#     \n      #..........................................#      \n       ##......................................##       \n         #####............................#####         \n              ####....................####              \n                  #..................#       ~~         \n      ~~~~~~      #..................#        ~~~       \n   ~~~~~~~        #..................#                  \n      ~~~~~~      #..................#                  \n                  #..................#                  \n                   #................#                   ","                                                        \n                                                        \n                                                        \n                                                        \n              #############################             \n         #####                             ####         \n       ##                                      ##       \n      #                                          #      \n     #          $                                 #     \n     #        $$$$                                #     \n     #        $  $                    \\           #     \n     #         $$                                 #     \n      #                                          #      \n       ##                                      ##       \n         #####                            #####         \n              ####                    ####              \n                  #                  #                  \n                  #                  #                  \n                  #                  #                  \n                  #                  #                  \n                  #                  #                  \n                   #1111111111111111#                   ",new Map([["1","rotating"]]),new Map([["#","#555555"],["~","#0000FF"]]),new Map,"#050500","",null,null,""),re=new z("                           #~~...~~#                    \n                           #~~...~~#                    \n        ~~~                #~~...~~#                    \n      ~~~~                #~~~....~~#                   \n                         #~~~......~~#        ~~~~      \n                        #~~~........~~#      ~~~~~~~    \n                        #~~..........~#         ~~      \n                        #~...........~#                 \n     ~~~                #~...........~#                 \n      ~~~               #.............#                 \n                        #.............#                 \n                        #.............#                 \n                        #.............#                 \n                        #.............#                 \n                        #.............#                 \n                        #~~~.....~~~~~#                 \n          ~~            #~~~.....~~~~~#   ~~~~          \n        ~~~~~~          #~~~...~~~~~~~#     ~~~~        \n           ~~           #~~~...~~~~~~~#                 \n                        #~~...~~~~~~~~#                 \n                        #~~...~~~~~~~~#                 \n                       #~~~~.~~~~~~~~~~#                ","                           #2222222#                    \n                           #       #                    \n                           #       #                    \n                          #         #                   \n                         #           #                  \n                        #             #                 \n                        #             #                 \n                        #             #                 \n                        #             #                 \n                        #             #                 \n                        #             #                 \n                        #             #                 \n                        #             #                 \n                        #             #                 \n                        #             #                 \n                        #             #                 \n                        #             #                 \n                        #             #                 \n                        #             #                 \n                        #   @         #                 \n                        #             #                 \n                       #111111111111111#                ",new Map([["1","swordOnly"],["2","lastChallenge"]]),new Map([["~","#0000FF"],['"',"#00FF00"]]),new Map,"#020302","",new B(function(e){0===e.tick&&(e.targets.push(new N(new D(30,-1),"O",3,3)),e.targets.push(new N(new D(31,-1),"O",3,3)),e.targets.push(new N(new D(32,-1),"O",3,3))),e.tick=(e.tick+1)%3},function(e){return new D(0,1)},function(e){return 3===e?"#00FF00":2===e?"#FFAA00":"#FF0000"}),null,""),ae=new z("                                                        \n                                                        \n##################################                      \n..................................##                    \n....................................##                  \n......................................#                 \n.......................................#                \n########################................#               \n                        #................#              \n      ~~~              #..................#             \n                     ##....................#            \n#####################.......................#           \n............................................#           \n............................................#           \n............................................#           \n####################.......................#            \n                    #######...........~~~~#             \n           ~~~             ##........~~~~#              \n         ~~~~                #.......~~~#               \n                             #.....~~~##                \n                            #.....~~##                  \n                           #~~...~~#                    ","                                                        \n                                                        \n##################################                      \n1                                 ##                    \n1                                   ##                  \n1                                     #                 \n1                                      #                \n########################                #               \n                        #                #              \n                       #                  #             \n                     ##                    #            \n#####################                       #           \n1                                           #           \n1                                           #           \n1                                           #           \n####################                       #            \n                    #######               #             \n                           ##            #              \n                             #          #               \n                             #        ##                \n                            #       ##                  \n                           #2222222#                    ",new Map([["2","hitSword"],["1","treasure"]]),new Map([["~","#0000FF"],['"',"#00FF00"]]),new Map,"#020302","",new B(function(e){e.tick%8===0||e.tick%8===1?(e.targets.push(new N(new D(-1,3),"O",1,1)),e.targets.push(new N(new D(-1,4),"O",1,1)),e.targets.push(new N(new D(-1,5),"O",1,1))):e.tick%6===2||7===e.tick?(e.targets.push(new N(new D(-1,3),"O",1,1)),e.targets.push(new N(new D(-1,4),"O",1,1)),e.targets.push(new N(new D(-1,6),"O",1,1))):e.tick%6===3||6===e.tick?(e.targets.push(new N(new D(-1,3),"O",1,1)),e.targets.push(new N(new D(-1,5),"O",1,1)),e.targets.push(new N(new D(-1,6),"O",1,1))):(e.targets.push(new N(new D(-1,4),"O",1,1)),e.targets.push(new N(new D(-1,5),"O",1,1)),e.targets.push(new N(new D(-1,6),"O",1,1))),e.targets.push(new N(new D(-1,11+e.tick%2),">",1,1)),e.targets.push(new N(new D(-1,13+e.tick%2),">",1,1)),e.tick=(e.tick+1)%8},function(e){return new D(1,0)},function(e){return"#00FFFF"}),null,""),oe=new z("########################################################\n#......................................................#\n#......................................................#\n#.......................................................\n#.......................................................\n#.......................................................\n#.......................................................\n#......................................................#\n#......................................................#\n#......................................................#\n#......................................................#\n#......................................................#\n#.......................................................\n#.......................................................\n#.......................................................\n#......................................................#\n#......................................................#\n#......................................................#\n#......................................................#\n#......................................................#\n#......................................................#\n########################################################","########################################################\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$#\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$#\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$1\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$1\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$1\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$1\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$#\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$#\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$#\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$#\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$#\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$1\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$1\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$1\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$#\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$#\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$#\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$#\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$#\n#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$#\n########################################################",new Map([["1","lastChallenge"]]),new Map([["#","#555555"],["~","#0000FF"]]),new Map,"#050500","",null,null,""),he=new Map([["bateau",V],["mission",K],["outside",Z],["training",J],["spike",Q],["spike2",G],["swordTreasure",ee],["leaveRock",te],["swordOnly",ne],["rotating",ie],["swordTreasure2",se],["hitSword",re],["lastChallenge",ae],["treasure",oe]]);function le(e){return e.charAt(0).toUpperCase()+e.substr(1)}var ue=new Map([["7",new D(45,0)],["8",new D(48,0)],["9",new D(51,0)],["4",new D(45,1)],["5",new D(48,1)],["6",new D(51,1)],["1",new D(45,2)],["2",new D(48,2)],["3",new D(51,2)]]),$e=new Intl.NumberFormat("fr-CH",{style:"decimal",minimumFractionDigits:0}),ce=function(){function e(){Object(o.a)(this,e),this.items=new Map,this.projectiles=new Array,this.spawner=null}return Object(h.a)(e,[{key:"print",value:function(){var e={items:{},projectiles:[],spawner:this.spawner.print()},t=!0,n=!1,i=void 0;try{for(var s,r=this.items[Symbol.iterator]();!(t=(s=r.next()).done);t=!0){var a=s.value,o=Object(c.a)(a,2),h=o[0],l=o[1],u=[],$=!0,p=!1,d=void 0;try{for(var v,f=l[Symbol.iterator]();!($=(v=f.next()).done);$=!0){var g=v.value;u.push({x:g.x,y:g.y,usage:g.usage})}}catch(x){p=!0,d=x}finally{try{$||null==f.return||f.return()}finally{if(p)throw d}}e.items[h]=u}}catch(x){n=!0,i=x}finally{try{t||null==r.return||r.return()}finally{if(n)throw i}}var w=!0,y=!1,m=void 0;try{for(var M,F=this.projectiles[Symbol.iterator]();!(w=(M=F.next()).done);w=!0){var _=M.value;e.projectiles.push({x:_.x,y:_.y,vx:_.vx,vy:_.vy,symbol:_.symbol,power:_.power})}}catch(x){y=!0,m=x}finally{try{w||null==F.return||F.return()}finally{if(y)throw m}}return e}},{key:"copy",value:function(){var t=new e;t.items=new Map;var n=!0,i=!1,s=void 0;try{for(var r,a=this.items[Symbol.iterator]();!(n=(r=a.next()).done);n=!0){var o=r.value,h=Object(c.a)(o,2),l=h[0],u=h[1],$=[],p=!0,d=!1,v=void 0;try{for(var f,g=u[Symbol.iterator]();!(p=(f=g.next()).done);p=!0){var w=f.value;$.push(w.copy())}}catch(b){d=!0,v=b}finally{try{p||null==g.return||g.return()}finally{if(d)throw v}}t.items.set(l,$)}}catch(b){i=!0,s=b}finally{try{n||null==a.return||a.return()}finally{if(i)throw s}}t.projectiles=[];var y=!0,m=!1,M=void 0;try{for(var F,_=this.projectiles[Symbol.iterator]();!(y=(F=_.next()).done);y=!0){var x=F.value;t.projectiles.push(x.copy())}}catch(b){m=!0,M=b}finally{try{y||null==_.return||_.return()}finally{if(m)throw M}}return null!=this.spawner&&(t.spawner=this.spawner.copy()),t}}],[{key:"parse",value:function(t){if(null===t)return null;var n=new e;for(var i in n.items=new Map,t.items)if(t.items.hasOwnProperty(i)){var s=[],r=t.items[i],a=!0,o=!1,h=void 0;try{for(var l,u=r[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var $=l.value;s.push(new P($.x,$.y,$.usage))}}catch(w){o=!0,h=w}finally{try{a||null==u.return||u.return()}finally{if(o)throw h}}n.items.set(i,s)}n.projectiles=[];var c=!0,p=!1,d=void 0;try{for(var v,f=t.projectiles[Symbol.iterator]();!(c=(v=f.next()).done);c=!0){var g=v.value;n.projectiles.push(new S(g.x,g.y,g.vx,g.vy,g.symbol,g.power))}}catch(w){p=!0,d=w}finally{try{c||null==f.return||f.return()}finally{if(p)throw d}}return n.spawner=q.parse(t.spawner),n}}]),e}(),pe=function(){function e(){Object(o.a)(this,e),this.weapon="",this.rocks=0,this.coins=0,this.heroPosition=new D(0,0),this.mapData=new Map,this.currentMapName=""}return Object(h.a)(e,[{key:"print",value:function(){var e={weapon:this.weapon,rocks:this.rocks,coins:this.coins,heroPosition:{x:this.heroPosition.x,y:this.heroPosition.y},mapData:{},currentMapName:this.currentMapName},t=!0,n=!1,i=void 0;try{for(var s,r=this.mapData[Symbol.iterator]();!(t=(s=r.next()).done);t=!0){var a=s.value,o=Object(c.a)(a,2),h=o[0],l=o[1];e.mapData[h]=l.print()}}catch(u){n=!0,i=u}finally{try{t||null==r.return||r.return()}finally{if(n)throw i}}return e}},{key:"copy",value:function(){var t=new e;t.weapon=this.weapon,t.rocks=this.rocks,t.coins=this.coins,t.heroPosition=this.heroPosition.copy(),t.mapData=new Map;var n=!0,i=!1,s=void 0;try{for(var r,a=this.mapData[Symbol.iterator]();!(n=(r=a.next()).done);n=!0){var o=r.value,h=Object(c.a)(o,2),l=h[0],u=h[1];t.mapData.set(l,u.copy())}}catch($){i=!0,s=$}finally{try{n||null==a.return||a.return()}finally{if(i)throw s}}return t.currentMapName=this.currentMapName,t}}],[{key:"parse",value:function(t){if(null===t)return null;if(void 0===t.heroPosition)return null;var n=new e;for(var i in n.weapon=t.weapon,n.rocks=t.rocks,n.coins=t.coins,n.heroPosition=new D(t.heroPosition.x,t.heroPosition.y),n.mapData=new Map,t.mapData)if(t.mapData.hasOwnProperty(i)){var s=ce.parse(t.mapData[i]);null!=s&&n.mapData.set(i,s)}return n.currentMapName=t.currentMapName,n}}]),e}(),de=function(){function e(){Object(o.a)(this,e),this.pressed=void 0,this.engine=void 0,this.charWidth=void 0,this.currentStatus=void 0,this.isThrowing=void 0,this.isMenuOpen=void 0,this.isMainMenu=void 0,this.menuPosition=0,this.mainMenu=new Array,this.gameMenu=new Array,this.gameOverMessage=void 0,this.lastSave=null,this.persistedData=new pe,this.initialPersistedData=null,this.fps=void 0,this.currentMap=null,this.currentMapData=new ce,this.engine=new T("canvas",460,480,16,"Inconsolata, monospace",!1,0),this.pressed=new Map([["1",!1],["2",!1],["3",!1],["4",!1],["5",!1],["6",!1],["7",!1],["8",!1],["9",!1],[" ",!1],["Shift",!1],["Escape",!1],["+",!1],["-",!1]]),this.currentStatus="",this.charWidth=this.engine.get_char_width(),this.isThrowing=!1,this.gameOverMessage="",this.isMenuOpen=!1,this.isMainMenu=!0,this.fps=6,this.parse_all_maps(),this.refresh_menu(!0)}return Object(h.a)(e,[{key:"parse_all_maps",value:function(){this.initialPersistedData=new pe,this.initialPersistedData.mapData=new Map;var e=!0,t=!1,n=void 0;try{for(var i,s=he[Symbol.iterator]();!(e=(i=s.next()).done);e=!0){var r=i.value,a=Object(c.a)(r,2),o=a[0],h=a[1];h.parse(o);var l=new ce;l.items=new Map,l.projectiles=[],l.spawner=new q([],0);var u=!0,$=!1,p=void 0;try{for(var d,v=h.initialItemPositions[Symbol.iterator]();!(u=(d=v.next()).done);u=!0){var f=d.value,g=Object(c.a)(f,2),w=g[0],y=g[1],m=[],M=!0,F=!1,_=void 0;try{for(var x,b=y[Symbol.iterator]();!(M=(x=b.next()).done);M=!0){var k=x.value;m.push(k.copy())}}catch(O){F=!0,_=O}finally{try{M||null==b.return||b.return()}finally{if(F)throw _}}l.items.set(w,m)}}catch(O){$=!0,p=O}finally{try{u||null==v.return||v.return()}finally{if($)throw p}}this.initialPersistedData.mapData.set(o,l)}}catch(O){t=!0,n=O}finally{try{e||null==s.return||s.return()}finally{if(t)throw n}}this.initialPersistedData.coins=0,this.initialPersistedData.weapon="",this.initialPersistedData.rocks=0,this.initialPersistedData.currentMapName="bateau",this.initialPersistedData.heroPosition=he.get("bateau").start}},{key:"draw",value:function(){this.isMainMenu?(this.engine.clear(v),this.draw_main_menu()):(null!=this.currentMap&&this.engine.clear(this.currentMap.backgroundColor),this.draw_all())}},{key:"do_update",value:function(){this.isMenuOpen||this.isMainMenu?this.update_menu():this.update_on_map()}},{key:"get_string_from",value:function(e,t,n){return null!=this.currentMap?this.currentMap.map.substr(57*t+e,n):""}},{key:"to_screen_coord",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return new D(this.charWidth*e+n,16*t+i)}},{key:"update_current_status",value:function(e){var t=!1,n=this.currentStatus;if(null!=this.currentMapData){var i=!0,s=!1,r=void 0;try{for(var a,o=this.currentMapData.items[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){for(var h=a.value,l=Object(c.a)(h,2),u=l[0],$=l[1],p=0;p<$.length;p++)if($[p].equals(e)){if("$"===u)this.persistedData.coins++,$.splice(p,1),n="> 1 $"+C.get("fr").get("M");else{var d=E.get("fr").get(u);n=L.get("fr")+d.text,$[p].usage>1&&(n+=" (x"+$[p].usage+")")}t=!0;break}if(t)break}}catch(v){s=!0,r=v}finally{try{i||null==o.return||o.return()}finally{if(s)throw r}}this.currentStatus=t?n:"","treasure"!==this.persistedData.currentMapName||(this.currentStatus="> Merci d'avoir jou\xe9!")}}},{key:"drop_current_slot_item_at",value:function(e,t,n){""!==t&&(this.currentMapData.items.has(t)||this.currentMapData.items.set(t,[]),this.currentMapData.items.get(t).push(new P(e.x,e.y,n)))}},{key:"try_pick_or_drop_item",value:function(e){if(this.pressed.get("5")){var t=!1,n=this.currentStatus,i=!0,s=!1,r=void 0;try{for(var a,o=this.currentMapData.items[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){for(var h=a.value,l=Object(c.a)(h,2),u=l[0],$=l[1],p=E.get("fr").get(u),d=0;d<$.length;d++)if($[d].equals(e)){x.indexOf(u)>-1?(""!==this.persistedData.weapon&&this.drop_current_slot_item_at($[d],this.persistedData.weapon,-1),this.persistedData.weapon=u):b.indexOf(u)>-1&&this.persistedData.rocks++,n="> "+le(p.text),$[d].usage>1&&(n+=" (x"+$[d].usage+")"),n+=C.get("fr").get(p.genre),$.splice(d,1),t=!0;break}if(t)break}}catch(v){s=!0,r=v}finally{try{i||null==o.return||o.return()}finally{if(s)throw r}}return this.currentStatus=t?n:"",!0}return!1}},{key:"try_enter_or_exit",value:function(e){var t=this.get_symbol_at(e);return">"!==t&&"<"!==t?[!1,new D(0,0),""]:this.do_teleport(t,new j(e.x,e.y,0),e,e)}},{key:"move_hero",value:function(e,t,n){var i=this.try_teleport(e,t);if(i[0])return this.change_map(i[2],!0),e=i[1],this.persistedData.heroPosition=i[1],[e,!0];var s=this.try_hit_target(e,n),r=Object(c.a)(s,1)[0];return""===r&&(e=t,this.update_current_status(e)),[e,!1]}},{key:"collides_with_obstacle",value:function(e){if(null==this.currentMap)return!1;if(void 0===this.currentMap.obstacleVisible)return!1;var t=!0,n=!1,i=void 0;try{for(var s,r=this.currentMap.obstacles[Symbol.iterator]();!(t=(s=r.next()).done);t=!0){var a=s.value,o=Object(c.a)(a,2),h=o[0],l=o[1];if(this.currentMap.obstacleVisible(this,h)){var u=!0,$=!1,p=void 0;try{for(var d,v=l[Symbol.iterator]();!(u=(d=v.next()).done);u=!0){var f=d.value;if(e.equals(f))return!0}}catch(g){$=!0,p=g}finally{try{u||null==v.return||v.return()}finally{if($)throw p}}}}}catch(g){n=!0,i=g}finally{try{t||null==r.return||r.return()}finally{if(n)throw i}}return!1}},{key:"get_future_position",value:function(e){var t=e.x,n=e.y;(this.pressed.get("1")||this.pressed.get("2")||this.pressed.get("3"))&&n++,(this.pressed.get("7")||this.pressed.get("8")||this.pressed.get("9"))&&n--,(this.pressed.get("1")||this.pressed.get("4")||this.pressed.get("7"))&&t--,(this.pressed.get("3")||this.pressed.get("6")||this.pressed.get("9"))&&t++;var i=new D(t,n),s=m,r=this.get_symbol_at(i);return s.indexOf(r)>-1||null==this.currentMap?[i,i,""]:e.y!==i.y?(r=this.currentMap.get_symbol_at(e.x,i.y),s.indexOf(r)>-1?[new D(e.x,i.y),i,""]:(i.x!==e.x&&(r=this.currentMap.get_symbol_at(i.x,e.y)),s.indexOf(r)>-1?[new D(i.x,e.y),i,""]:[e,i,""])):(r=this.currentMap.get_symbol_at(i.x,e.y),s.indexOf(r)>-1?[new D(i.x,e.y),i,""]:[e,i,""])}},{key:"change_map",value:function(e,t){this.currentMap=he.get(e),this.persistedData.currentMapName=e,this.currentMapData=this.persistedData.mapData.get(e),t&&null!=this.currentMapData.spawner&&this.currentMapData.spawner.reset()}},{key:"save_to_memory",value:function(){this.lastSave=this.persistedData.copy()}},{key:"load_last_save",value:function(){null!=this.lastSave&&(this.persistedData=this.lastSave.copy()),this.change_map(this.persistedData.currentMapName,!1)}},{key:"try_teleport",value:function(e,t){if(null!=this.currentMap){var n=!0,i=!1,s=void 0;try{for(var r,a=this.currentMap.teleports[Symbol.iterator]();!(n=(r=a.next()).done);n=!0){var o=r.value,h=Object(c.a)(o,2),l=h[0],u=h[1];if("<"!==l&&">"!==l){var $=!0,p=!1,d=void 0;try{for(var v,f=u[Symbol.iterator]();!($=(v=f.next()).done);$=!0){var g=v.value;if(g.equals(t))return this.do_teleport(l,g,e,t)}}catch(w){p=!0,d=w}finally{try{$||null==f.return||f.return()}finally{if(p)throw d}}}}}catch(w){i=!0,s=w}finally{try{n||null==a.return||a.return()}finally{if(i)throw s}}}return[!1,new D(0,0),""]}},{key:"do_teleport",value:function(e,t,n,i){if(null==this.currentMap)return[!1,new D(0,0),""];var s,r,a=this.currentMap.teleportMap.get(e),o=he.get(a);">"===e?(s=o.teleports.get("<"),r=0):"<"===e?(s=o.teleports.get(">"),r=0):(s=o.teleports.get(e),r=t.id);var h=s[r],l=h.x+(i.x-n.x),u=h.y+(i.y-n.y);return"#"===o.get_symbol_at(l,u)&&("#"===o.get_symbol_at(h.x,u)?u=h.y:l=h.x),[!0,new D(l,u),a]}},{key:"try_hit_target",value:function(e,t){if(null==this.currentMap||null==this.currentMapData.spawner||null===this.currentMap.targetSpawner)return["",""];for(var n=this.currentMapData.spawner.targets,i=0;i<n.length;){var s=n[i];if(s.pos.equals(t)){var r=this.get_weapon_damage();return"O"===s.symbol&&0!==r?(s.pv-=r,s.pv<=0?(n.splice(i,1),["hit",s.symbol]):["push",s.symbol]):["push",s.symbol]}i++}return["",""]}},{key:"update_targets",value:function(e){return null!=this.currentMap&&null!=this.currentMap.targetSpawner&&null!=this.currentMapData&&null!=this.currentMapData.spawner?this.currentMap.targetSpawner.update(this,this.currentMapData.spawner,e):e}},{key:"move_projectiles",value:function(){if(null!=this.currentMap)for(var e=0;e<this.currentMapData.projectiles.length;){var t=this.currentMapData.projectiles[e],n=t.x+t.vx,i=t.y+t.vy;if(i>=22||i<0||n<0||n>=56){var s=this.try_teleport(t,t),r=Object(c.a)(s,3),a=r[0],o=r[1],h=r[2];if(a){var l=this.persistedData.mapData.get(h);this.projectile2item(l,new D(o.x+t.vx,o.y+t.vy),e);continue}}var u=this.currentMap.get_symbol_at(n,i);-1!==m.indexOf(u)?(t.x=n,t.y=i,e++):this.projectile2item(this.currentMapData,t,e)}}},{key:"move_targets_or_die",value:function(e){e=this.update_targets(e);var t=this.get_symbol_at(e);-1===m.indexOf(t)?this.gameOverMessage=I.get("fr").get(t):this.persistedData.heroPosition=e}},{key:"update_menu",value:function(){var e;if(e=this.isMainMenu?this.mainMenu:this.gameMenu,this.pressed.get("8")){var t=this.menuPosition;if(t>0)do{t--}while(-1!==t&&!e[t][2]);-1!==t&&(this.menuPosition=t)}if(this.pressed.get("2")){var n=this.menuPosition;if(n<e.length)do{n++}while(n!==e.length&&!e[n][2]);n!==e.length&&(this.menuPosition=n)}this.pressed.get("5")&&e[this.menuPosition][1](this),!this.isMainMenu&&this.pressed.get("Escape")&&(this.isMenuOpen=!1)}},{key:"update_on_map",value:function(){if(""===this.gameOverMessage)if(this.pressed.get("+")&&this.fps++,this.pressed.get("-")&&this.fps--,this.pressed.get("Shift")&&this.persistedData.rocks>0)this.isThrowing=!this.isThrowing;else{if(this.pressed.get("Escape"))return this.isMenuOpen=!0,this.menuPosition=0,void this.refresh_menu(!1);var e=this.get_future_position(this.persistedData.heroPosition),t=this.try_enter_or_exit(e[0]);if(void 0!==t&&t[0])return this.change_map(t[2],!0),this.persistedData.heroPosition=t[1],void this.save_to_memory();if(this.try_pick_or_drop_item(this.persistedData.heroPosition))return this.move_projectiles(),void this.move_targets_or_die(this.persistedData.heroPosition);if(this.isThrowing&&this.persistedData.rocks>0){var n=E.get("fr").get("*");this.currentStatus="> "+le(n.text+H.get("fr").get(n.genre));var i=this.persistedData.heroPosition.x,s=this.persistedData.heroPosition.y,r=e[1].x-i,a=e[1].y-s;0===r&&0===a||(this.currentMapData.projectiles.push(new S(i,s,r,a,"*",1)),this.persistedData.rocks--,this.isThrowing=!1,this.move_projectiles(),this.move_targets_or_die(this.persistedData.heroPosition))}else{if(""!==e[2])return this.currentStatus=e[2],this.move_projectiles(),void this.move_targets_or_die(this.persistedData.heroPosition);if(!this.collides_with_obstacle(e[0])){var o=this.move_hero(this.persistedData.heroPosition,e[0],e[1]),h=Object(c.a)(o,2),l=h[0],u=h[1];this.persistedData.heroPosition=l,u||this.move_projectiles(),this.move_targets_or_die(this.persistedData.heroPosition),u&&""===this.gameOverMessage&&this.save_to_memory()}}}else this.pressed.get(" ")&&(this.gameOverMessage="",this.load_last_save())}},{key:"draw_map",value:function(){if(null!=this.currentMap){for(var e=0;e<22;e++)for(var t=0;t<56;){var n=0,i=this.currentMap.get_symbol_at(t,e);if(" "!==i&&"\n"!==i&&void 0!==i){for(;;){if(n++,this.currentMap.get_symbol_at(t+n,e)!==i)break}var s=this.to_screen_coord(t,e+3),r=this.get_string_from(t,e,n),a=void 0;void 0!==this.currentMap.tile2color&&(a=this.currentMap.tile2color.get(i)),void 0===a&&(a=g.get(i)),void 0===a&&(a=this.currentMap.textColor),this.engine.rect(s,r.length*this.charWidth,16,this.currentMap.backgroundColor),this.engine.text(r,s,a),t+=n}else t++}if(void 0!==this.currentMap.texts){var o=this.currentMap.texts.get("fr");if(void 0!==o){var h=!0,l=!1,u=void 0;try{for(var $,p=o[Symbol.iterator]();!(h=($=p.next()).done);h=!0){var d=$.value,v=Object(c.a)(d,2),f=v[0],w=v[1];this.engine.text(f,this.to_screen_coord(w.x,w.y),this.currentMap.textColor)}}catch(y){l=!0,u=y}finally{try{h||null==p.return||p.return()}finally{if(l)throw u}}}}}}},{key:"draw_projectiles",value:function(){if(null!=this.currentMap){var e=!0,t=!1,n=void 0;try{for(var i,s=this.currentMapData.projectiles[Symbol.iterator]();!(e=(i=s.next()).done);e=!0){var r=i.value,a=this.to_screen_coord(r.x,r.y+3);this.engine.rect(a,this.charWidth,16,this.currentMap.backgroundColor),this.engine.text(r.symbol,a,k.get(r.symbol))}}catch(o){t=!0,n=o}finally{try{e||null==s.return||s.return()}finally{if(t)throw n}}}}},{key:"draw_targets",value:function(){if(null!=this.currentMap&&null!=this.currentMap.targetSpawner&&null!=this.currentMapData.spawner){var e=!0,t=!1,n=void 0;try{for(var i,s=this.currentMapData.spawner.targets[Symbol.iterator]();!(e=(i=s.next()).done);e=!0){var r=i.value,a=this.to_screen_coord(r.pos.x,r.pos.y+3);this.engine.rect(a,this.charWidth,16,this.currentMap.backgroundColor),this.engine.text(r.symbol,a,this.currentMap.targetSpawner.pv2color(r.pv))}}catch(o){t=!0,n=o}finally{try{e||null==s.return||s.return()}finally{if(t)throw n}}}}},{key:"draw_obstacles",value:function(){if(null==this.currentMap)return!1;var e=!0,t=!1,n=void 0;try{for(var i,s=this.currentMap.obstacles[Symbol.iterator]();!(e=(i=s.next()).done);e=!0){var r=i.value,a=Object(c.a)(r,2),o=a[0],h=a[1];if(this.currentMap.obstacleVisible(this,o)){var l=!0,u=!1,$=void 0;try{for(var p,d=h[Symbol.iterator]();!(l=(p=d.next()).done);l=!0){var v=p.value,f=this.to_screen_coord(v.x,v.y+3);this.engine.rect(f,this.charWidth,16,this.currentMap.backgroundColor),this.engine.text(o,f,this.currentMap.obstacleColor)}}catch(g){u=!0,$=g}finally{try{l||null==d.return||d.return()}finally{if(u)throw $}}}}}catch(g){t=!0,n=g}finally{try{e||null==s.return||s.return()}finally{if(t)throw n}}}},{key:"draw_character",value:function(e,t,n){null!=this.currentMap&&(this.engine.rect(t,this.charWidth,16,this.currentMap.backgroundColor),this.engine.text(e,t,n))}},{key:"draw_hero",value:function(){this.draw_character("@",this.to_screen_coord(this.persistedData.heroPosition.x,this.persistedData.heroPosition.y+3),F.get("@"))}},{key:"draw_items",value:function(){if(null!=this.currentMap){var e=!0,t=!1,n=void 0;try{for(var i,s=this.currentMapData.items[Symbol.iterator]();!(e=(i=s.next()).done);e=!0){var r=i.value,a=Object(c.a)(r,2),o=a[0],h=a[1],l=!0,u=!1,$=void 0;try{for(var p,d=h[Symbol.iterator]();!(l=(p=d.next()).done);l=!0){var v=p.value,f=this.to_screen_coord(v.x,v.y+3),g=_.get(o);this.engine.rect(f,this.charWidth,16,this.currentMap.backgroundColor),this.engine.text(o,f,g)}}catch(w){u=!0,$=w}finally{try{l||null==d.return||d.return()}finally{if(u)throw $}}}}catch(w){t=!0,n=w}finally{try{e||null==s.return||s.return()}finally{if(t)throw n}}}}},{key:"get_weapon_damage",value:function(){return O.get(this.persistedData.weapon)}},{key:"get_symbol_at",value:function(e){return null==this.currentMap?"":this.currentMap.get_symbol_at(e.x,e.y)}},{key:"hits_projectile",value:function(e){for(var t=0;t<this.currentMapData.projectiles.length;t++){var n=this.currentMapData.projectiles[t];if(n.equals(e))return[t,n.power]}return[-1,0]}},{key:"projectile2item",value:function(e,t,n){var i=this.currentMapData.projectiles[n];e.items.has(i.symbol)||e.items.set(i.symbol,[]);var s=e.items.get(i.symbol),r=!1,a=!0,o=!1,h=void 0;try{for(var l,u=s[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var $=l.value;if($.equals(i)){$.usage++,r=!0;break}}}catch(c){o=!0,h=c}finally{try{a||null==u.return||u.return()}finally{if(o)throw h}}r||s.push(new P(t.x,t.y,1)),this.currentMapData.projectiles.splice(n,1)}},{key:"draw_overlay",value:function(){this.engine.text(this.currentStatus,this.to_screen_coord(2,1),"#FFFFFF");var e=$e.format(this.persistedData.coins)+" $";this.engine.text(e,this.to_screen_coord(56-e.length-7,1),_.get("$")),this.engine.text("[esc]",this.to_screen_coord(50,1),"#555555");var t=26,n=!0,i=!1,s=void 0;try{for(var r,a=ue[Symbol.iterator]();!(n=(r=a.next()).done);n=!0){var o=r.value,h=Object(c.a)(o,2),l=h[0],u=h[1];this.isThrowing?this.engine.text(l,this.to_screen_coord(u.x,u.y+t),"#FF00FF"):this.pressed.get(l)?this.engine.text(l,this.to_screen_coord(u.x,u.y+t),"#FFFFFF"):this.engine.text(l,this.to_screen_coord(u.x,u.y+t),"#555555")}}catch(p){i=!0,s=p}finally{try{n||null==a.return||a.return()}finally{if(i)throw s}}if(""!==this.persistedData.weapon&&this.engine.text("- "+le(E.get("fr").get(this.persistedData.weapon).text),this.to_screen_coord(3,t),"#FFFFFF"),0!==this.persistedData.rocks&&this.engine.text("- "+le(E.get("fr").get("*").text)+" (x"+this.persistedData.rocks+")",this.to_screen_coord(3,27),"#FFFFFF"),this.persistedData.rocks>0){var $="\u21e7 "+W.get("fr");this.isThrowing?this.engine.text($,this.to_screen_coord(29,27,-2),"#FF00FF"):this.engine.text($,this.to_screen_coord(29,27,-2),"#FFFFFF")}}},{key:"draw_message",value:function(){if(""!==this.gameOverMessage&&null!=this.currentMap){var e=A.get("fr");this.engine.rect(this.to_screen_coord(13,10),30*this.charWidth,112,this.currentMap.backgroundColor),this.engine.text(" **************************** ",this.to_screen_coord(13,10),"#FFFFFF");for(var t=11;t<16;t++)this.engine.text("*                            *",this.to_screen_coord(13,t),"#FFFFFF");this.engine.text(" **************************** ",this.to_screen_coord(13,16),"#FFFFFF"),this.engine.text(this.gameOverMessage,this.to_screen_coord(28-this.gameOverMessage.length/2,12),"#FFFFFF"),this.engine.text(e,this.to_screen_coord(28-e.length/2,14),"#FFFFFF")}}},{key:"draw_main_menu",value:function(){var e=0,t=!0,n=!1,i=void 0;try{for(var s,r=this.mainMenu[Symbol.iterator]();!(t=(s=r.next()).done);t=!0){var a=s.value,o=Object(c.a)(a,3),h=o[0],l=o[2],u=void 0,$=10,p=void 0;this.menuPosition===e?u="> "+h:(u=h,$+=2),p=l?"#FFFFFF":"#555555",this.engine.text(u,this.to_screen_coord($,12+e),p),e++}}catch(d){n=!0,i=d}finally{try{t||null==r.return||r.return()}finally{if(n)throw i}}}},{key:"draw_menu",value:function(){if(this.isMenuOpen&&null!=this.currentMap){var e;for(this.engine.rect(this.to_screen_coord(13,10),30*this.charWidth,112,this.currentMap.backgroundColor),this.engine.text(" **************************** ",this.to_screen_coord(13,10),"#FFFFFF"),e=11;e<16;e++)this.engine.text("*                            *",this.to_screen_coord(13,e),"#FFFFFF");this.engine.text(" **************************** ",this.to_screen_coord(13,16),"#FFFFFF"),e=0;var t=!0,n=!1,i=void 0;try{for(var s,r=this.gameMenu[Symbol.iterator]();!(t=(s=r.next()).done);t=!0){var a=s.value,o=Object(c.a)(a,3),h=o[0],l=o[2],u=void 0,$=23,p=void 0;this.menuPosition===e?u="> "+h:(u=h,$+=2),p=l?"#FFFFFF":"#555555",this.engine.text(u,this.to_screen_coord($,12+e),p),e++}}catch(d){n=!0,i=d}finally{try{t||null==r.return||r.return()}finally{if(n)throw i}}}}},{key:"draw_all",value:function(){this.draw_map(),this.draw_items(),this.draw_hero(),this.draw_projectiles(),this.draw_targets(),this.draw_obstacles(),this.draw_overlay(),this.draw_message(),this.draw_menu()}},{key:"resize",value:function(e,t){this.engine.resize(e,t),this.draw()}},{key:"refresh_menu",value:function(t){var n=e.get_from_storage();this.mainMenu=[[R.get("fr"),function(t){return e.clear_and_start_tt(t)},!0],[U.get("fr"),function(t){return e.load_save(t,null!=n?n:new pe)},null!=n]],this.gameMenu=[[X.get("fr"),function(t){return e.save_to_storage(t)},!0],[U.get("fr"),function(t){return e.load_from_storage(t)},null!=n],[Y.get("fr"),function(t){return e.open_main_menu(t)},!0]],t&&(this.mainMenu[1][2]?this.menuPosition=1:this.menuPosition=0)}}],[{key:"load_save",value:function(e,t){e.persistedData=t,e.isMainMenu=!1,e.isMenuOpen=!1,null!=e.persistedData&&e.change_map(e.persistedData.currentMapName,!1),e.isMenuOpen=!1,e.save_to_memory()}},{key:"load_from_storage",value:function(t){var n=e.get_from_storage();null!=n&&e.load_save(t,n)}},{key:"save_to_storage",value:function(e){if(null!=e.persistedData){var t=JSON.stringify(e.persistedData.print());window.localStorage.setItem("save",t)}e.isMenuOpen=!1}},{key:"clear_storage",value:function(){window.localStorage.clear()}},{key:"get_from_storage",value:function(){var e=window.localStorage.getItem("save");if(null==e)return null;var t=pe.parse(JSON.parse(e));return null===t?null:t}},{key:"open_main_menu",value:function(e){e.refresh_menu(!0),e.isMainMenu=!0}},{key:"clear_and_start_tt",value:function(t){if(null!=t.initialPersistedData){var n=t.initialPersistedData.copy();e.load_save(t,n)}}}]),e}(),ve=(n(17),function(e){function t(){var e,n;Object(o.a)(this,t);for(var i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).labyrinth=null,n.doUpdate=function(){if(null!=n.labyrinth){n.labyrinth.do_update(),n.labyrinth.draw();var e=!0,t=!1,i=void 0;try{for(var s,r=n.labyrinth.pressed[Symbol.iterator]();!(e=(s=r.next()).done);e=!0){var a=s.value,o=Object(c.a)(a,1)[0];n.labyrinth.pressed.set(o,!1)}}catch(h){t=!0,i=h}finally{try{e||null==r.return||r.return()}finally{if(t)throw i}}}},n.onResize=function(){null!=n.labyrinth&&n.labyrinth.resize(window.innerWidth,window.innerHeight)},n.onKeydown=function(e){if(null!=n.labyrinth){var t=!1;n.labyrinth.pressed.has(e.key)?(n.labyrinth.pressed.set(e.key,!0),t=!0):"ArrowLeft"===e.key?(n.labyrinth.pressed.set("4",!0),t=!0):"ArrowRight"===e.key?(n.labyrinth.pressed.set("6",!0),t=!0):"ArrowUp"===e.key?(n.labyrinth.pressed.set("8",!0),t=!0):"ArrowDown"===e.key?(n.labyrinth.pressed.set("2",!0),t=!0):"Enter"===e.key&&(n.labyrinth.pressed.set("5",!0),t=!0),t&&n.doUpdate()}},n}return Object($.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){document.body.style.overflow="hidden";var e=new de;this.labyrinth=e,this.labyrinth.resize(window.innerWidth,window.innerHeight),window.addEventListener("resize",this.onResize),window.addEventListener("keydown",this.onKeydown),new p("Inconsolata").load().then(function(){e.draw()})}},{key:"render",value:function(){return i.createElement("div",{id:"canvasContainer"},i.createElement("canvas",{id:"canvas"},"Your browser doesn't seem to support HTML5. Please upgrade your browser."))}}]),t}(i.Component)),fe=(n(18),function e(t,n){Object(o.a)(this,e),this.image=void 0,this.image=n.load(t)}),ge=function(){function e(){Object(o.a)(this,e),this.loadedTextures=0,this.totalTextures=0,this.allTexturesLoaded=!1,this.loadedFunction=function(){},this.isInitialized=!1}return Object(h.a)(e,[{key:"setLoadedFunction",value:function(e){this.loadedFunction=e}},{key:"load",value:function(e){var t=this;this.totalTextures++;var n=new Image;return n.onload=function(){t.loadedTextures++,t.allTexturesLoaded&&t.loadedTextures===t.totalTextures&&(t.isInitialized=!0,t.loadedFunction())},n.src=e,n}},{key:"waitLoaded",value:function(){this.allTexturesLoaded=!0,this.totalTextures===this.loadedTextures&&(this.isInitialized=!0,this.loadedFunction())}}]),e}(),we=function(){function e(){Object(o.a)(this,e),this.engine=null,this.tilesets=new Map,this.tilesize=0,this.cells=new Map,this.isClicking=!1,this.shiftLeft=0,this.shiftTop=0}return Object(h.a)(e,[{key:"setHandles",value:function(e,t,n){this.engine=e,this.tilesets=t,this.tilesize=n,this.cells=new Map}},{key:"draw",value:function(e){var t=0,n=0;if(null!=e&&(t=e.outerWidth(),n=e.outerHeight()),null!=this.engine){var i=!1,s=!0,r=!1,a=void 0;try{for(var o,h=this.cells[Symbol.iterator]();!(s=(o=h.next()).done);s=!0){var l=o.value,u=Object(c.a)(l,2),$=u[0],p=u[1],d=this.tilesets.get(p.tileset),v=($.x+this.shiftLeft)*this.tilesize,f=($.y+this.shiftTop)*this.tilesize;v<0||v>=this.engine.referenceWidth-t||f<0||f>=this.engine.referenceHeight||(this.engine.img(d,new D(v+t,f+n),p.tileX,p.tileY),this.engine.mousePosX>=v&&this.engine.mousePosX<v+this.tilesize&&this.engine.mousePosY>=f&&this.engine.mousePosY<f+this.tilesize&&v<this.engine.referenceWidth&&(this.engine.rect(new D(v,f),this.tilesize,this.tilesize,"rgba(55, 55, 55, 0.5)"),i=!0))}}catch(y){r=!0,a=y}finally{try{s||null==h.return||h.return()}finally{if(r)throw a}}if(!i&&this.engine.mousePosX>=t){var g=this.engine.mousePosX-(this.engine.mousePosX-t)%this.tilesize,w=this.engine.mousePosY-(this.engine.mousePosY-n)%this.tilesize;this.engine.rect(new D(g,w),this.tilesize,this.tilesize,"rgba(55, 55, 55, 0.5)")}}}},{key:"onMouseMove",value:function(e){if(this.isClicking&&null!=e&&null!=this.engine){var t=e.outerWidth(),n=e.outerHeight(),i=Math.floor((this.engine.mousePosX-t)/this.tilesize),s=Math.floor((this.engine.mousePosY-n)/this.tilesize),r=(this.engine.referenceWidth-t)/this.tilesize,a=(this.engine.referenceHeight-n)/this.tilesize;i>=0&&s>=0&&i<r&&s<a&&this.cells.set(new D(i-this.shiftLeft,s-this.shiftTop),{tileset:e.currentMenu,tileX:e.currentTileIndexX,tileY:e.currentTileIndexY})}}},{key:"mouseDown",value:function(e){this.isClicking=!0,this.onMouseMove(e)}},{key:"mouseUp",value:function(){this.isClicking=!1}}]),e}(),ye=function(){function e(){Object(o.a)(this,e),this.currentTileIndexX=0,this.currentTileIndexY=0,this.currentMenu="tiles",this.leftPanelWidth=112,this.topBarHeight=10,this.margin=6,this.engine=null,this.tilesets=new Map,this.tilesize=0}return Object(h.a)(e,[{key:"setHandles",value:function(e,t,n){this.engine=e,this.tilesets=t,this.tilesize=n}},{key:"outerWidth",value:function(){return this.leftPanelWidth+this.margin}},{key:"outerHeight",value:function(){return this.topBarHeight+this.margin}},{key:"draw",value:function(){if(null!=this.engine){for(var e=this.tilesets.get(this.currentMenu),t=e.image.width,n=e.image.height,i=t/this.tilesize,s=n/this.tilesize,r=0;r<i;r++)for(var a=0;a<s;a++){var o=r*this.tilesize,h=a*this.tilesize+this.outerHeight();this.engine.img(e,new D(o,h),r,a),r===this.currentTileIndexX&&a===this.currentTileIndexY?this.engine.rect(new D(o,h),this.tilesize,this.tilesize,"rgba(25, 25, 25, 0.5)"):this.engine.mousePosX>=o&&this.engine.mousePosX<o+this.tilesize&&this.engine.mousePosY>=h&&this.engine.mousePosY<h+this.tilesize&&this.engine.rect(new D(o,h),this.tilesize,this.tilesize,"rgba(55, 55, 55, 0.5)")}this.engine.rect(new D(this.leftPanelWidth,0),this.margin,this.engine.referenceHeight,"#000000"),"tiles"===this.currentMenu?this.engine.text("tiles",new D(4,8),"#FFF"):this.engine.text("tiles",new D(4,8),"#000"),"foes"===this.currentMenu?this.engine.text("foes",new D(37,8),"#FFF"):this.engine.text("foes",new D(37,8),"#000"),"goodies"===this.currentMenu?this.engine.text("goodies",new D(68,8),"#FFF"):this.engine.text("goodies",new D(68,8),"#000")}}},{key:"onClick",value:function(){if(null!=this.engine&&this.engine.mousePosX<this.leftPanelWidth){var e=this.tilesets.get(this.currentMenu),t=Math.floor(this.engine.mousePosX/this.tilesize),n=Math.floor((this.engine.mousePosY-this.outerHeight())/this.tilesize),i=e.image.width/this.tilesize,s=e.image.height/this.tilesize;return t>=0&&n>=0&&t<i&&n<s&&(this.currentTileIndexX=t,this.currentTileIndexY=n),!0}return!1}}]),e}(),me=function(){function e(t){Object(o.a)(this,e),this.pressed=void 0,this.tilesize=16,this.engine=void 0,this.textureLoader=void 0,this.tilesets=new Map,this.editor=void 0,this.level=void 0,this.fps=void 0;var n=256,i=224;t?(this.editor=new ye,n+=this.editor.outerWidth(),i+=this.editor.outerHeight()):this.editor=null,this.level=new we,this.engine=new T("canvas",n,i,6,"wonder",!0,this.tilesize),this.pressed=new Map,this.pressed.set("ArrowUp",{pressed:!1,prevPressed:!1}),this.pressed.set("ArrowDown",{pressed:!1,prevPressed:!1}),this.pressed.set("ArrowLeft",{pressed:!1,prevPressed:!1}),this.pressed.set("ArrowRight",{pressed:!1,prevPressed:!1}),this.textureLoader=new ge,this.fps=30}return Object(h.a)(e,[{key:"loop",value:function(){var e=this;this.textureLoader.setLoadedFunction(function(){e.updateAndDraw()}),this.tilesets.set("tiles",new fe("/tileset.png",this.textureLoader)),this.tilesets.set("foes",new fe("/foes.png",this.textureLoader)),null!=this.editor&&this.editor.setHandles(this.engine,this.tilesets,this.tilesize),this.level.setHandles(this.engine,this.tilesets,this.tilesize),this.textureLoader.waitLoaded()}},{key:"updateAndDraw",value:function(){var e=this;setInterval(function(){e.doUpdate(),e.draw()},1e3/this.fps)}},{key:"draw",value:function(){this.engine.clear("#888888"),this.textureLoader.isInitialized?(null!=this.editor&&this.editor.draw(),this.level.draw(this.editor)):this.engine.textCentered("Loading...",40,"#FFFFFF")}},{key:"doUpdate",value:function(){var e=this.pressed.get("ArrowUp");e.pressed&&!e.prevPressed&&(this.level.shiftTop++,e.prevPressed=e.pressed),(e=this.pressed.get("ArrowDown")).pressed&&!e.prevPressed&&(this.level.shiftTop--,e.prevPressed=e.pressed),(e=this.pressed.get("ArrowLeft")).pressed&&!e.prevPressed&&(this.level.shiftLeft++,e.prevPressed=e.pressed),(e=this.pressed.get("ArrowRight")).pressed&&!e.prevPressed&&(this.level.shiftLeft--,e.prevPressed=e.pressed)}},{key:"resize",value:function(e,t){this.engine.resize(e,t),this.draw()}},{key:"setMousePos",value:function(e,t){void 0!==this.engine&&null!=this.engine&&(this.engine.setMousePos(e,t),this.level.onMouseMove(this.editor))}},{key:"mouseDown",value:function(e,t){this.engine.click(e,t),null!=this.editor&&this.editor.onClick()||this.level.mouseDown(this.editor)}},{key:"mouseUp",value:function(){this.level.mouseUp()}}]),e}(),Me=function(e){function t(){var e,n;Object(o.a)(this,t);for(var i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).game=null,n.onResize=function(){null!=n.game&&n.game.resize(window.innerWidth,window.innerHeight)},n.onKeydown=function(e){null!=n.game&&n.game.pressed.has(e.key)&&n.game.pressed.set(e.key,{pressed:!0,prevPressed:n.game.pressed.get(e.key).pressed})},n.onKeyup=function(e){null!=n.game&&n.game.pressed.has(e.key)&&n.game.pressed.set(e.key,{pressed:!1,prevPressed:n.game.pressed.get(e.key).pressed})},n.onMouseMove=function(e){null!=n.game&&n.game.setMousePos(e.pageX,e.pageY)},n.onMouseDown=function(e){null!=n.game&&n.game.mouseDown(e.pageX,e.pageY)},n.onMouseUp=function(e){null!=n.game&&n.game.mouseUp()},n}return Object($.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){document.body.style.overflow="hidden",window.addEventListener("resize",this.onResize),window.addEventListener("keydown",this.onKeydown),window.addEventListener("keyup",this.onKeyup),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mousemove",this.onMouseMove);var e=new me(!0);this.game=e,this.game.resize(window.innerWidth,window.innerHeight),e.loop()}},{key:"render",value:function(){return i.createElement("div",{id:"canvasContainer"},i.createElement("canvas",{id:"canvas"},"Your browser doesn't seem to support HTML5. Please upgrade your browser."))}}]),t}(i.Component),Fe={position:"absolute",left:20,top:20,fontSize:"30px",userSelect:"none",cursor:"pointer"},_e=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).switchToRogue=function(){n.setState({view:"Rogue"})},n.switchToMap=function(){n.setState({view:"MapEdit"})},n.state=t.defaultProps,n}return Object($.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("div",{style:Fe},s.a.createElement("span",{role:"img","aria-label":"Switch to Rogue",onClick:this.switchToRogue},"\ud83e\uddd9\u200d\u2642"),s.a.createElement("br",null),s.a.createElement("span",{role:"img","aria-label":"Switch to MapEdit",onClick:this.switchToMap},"\ud83d\udc69\u200d\ud83c\udfa8")),"Rogue"===this.state.view&&s.a.createElement(ve,null),"MapEdit"===this.state.view&&s.a.createElement(Me,null))}}]),t}(s.a.Component);_e.defaultProps={view:"Rogue"};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(s.a.createElement(_e,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}],[[10,1,2]]]);
//# sourceMappingURL=main.e16e0d01.chunk.js.map